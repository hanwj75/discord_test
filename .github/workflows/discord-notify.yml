name: Discord ì•Œë¦¼

on:
  pull_request:
    types: [opened, synchronize, closed, reopened, ready_for_review]
  push:
    branches: [main, develop]

jobs:
  discord-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Discord ì•Œë¦¼ ì „ì†¡
        run: |
          # Discord Webhook URL (GitHub Secretsì—ì„œ ê°€ì ¸ì˜´)
          DISCORD_WEBHOOK_URL="${{ secrets.DISCORD_WEBHOOK_URL }}"

          # ì´ë²¤íŠ¸ íƒ€ì…ì— ë”°ë¼ ë©”ì‹œì§€ êµ¬ì„±
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            # PR ì´ë²¤íŠ¸
            ACTION="${{ github.event.action }}"
            PR_TITLE="${{ github.event.pull_request.title }}"
            PR_URL="${{ github.event.pull_request.html_url }}"
            AUTHOR="${{ github.event.pull_request.user.login }}"
            REPO="${{ github.repository }}"
            
            case $ACTION in
              "opened")
                MESSAGE="ğŸ”” **ìƒˆë¡œìš´ PRì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!**\n\nğŸ“ **ì €ì¥ì†Œ:** $REPO\nğŸ™‹ **ì‘ì„±ì:** $AUTHOR\nğŸ“ **ì œëª©:** $PR_TITLE\nğŸ”— **ë§í¬:** $PR_URL"
                ;;
              "closed")
                if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
                  MESSAGE="âœ… **PRì´ ë¨¸ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!**\n\nğŸ“ **ì €ì¥ì†Œ:** $REPO\nğŸ™‹ **ì‘ì„±ì:** $AUTHOR\nğŸ“ **ì œëª©:** $PR_TITLE\nğŸ”— **ë§í¬:** $PR_URL"
                else
                  MESSAGE="âŒ **PRì´ ë‹«í˜”ìŠµë‹ˆë‹¤!**\n\nğŸ“ **ì €ì¥ì†Œ:** $REPO\nğŸ™‹ **ì‘ì„±ì:** $AUTHOR\nğŸ“ **ì œëª©:** $PR_TITLE\nğŸ”— **ë§í¬:** $PR_URL"
                fi
                ;;
              "reopened")
                MESSAGE="ğŸ”„ **PRì´ ë‹¤ì‹œ ì—´ë ¸ìŠµë‹ˆë‹¤!**\n\nğŸ“ **ì €ì¥ì†Œ:** $REPO\nğŸ™‹ **ì‘ì„±ì:** $AUTHOR\nğŸ“ **ì œëª©:** $PR_TITLE\nğŸ”— **ë§í¬:** $PR_URL"
                ;;
              *)
                MESSAGE="ğŸ“ **PRì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!**\n\nğŸ“ **ì €ì¥ì†Œ:** $REPO\nğŸ™‹ **ì‘ì„±ì:** $AUTHOR\nğŸ“ **ì œëª©:** $PR_TITLE\nğŸ”— **ë§í¬:** $PR_URL"
                ;;
            esac
          else
            # Push ì´ë²¤íŠ¸
            COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
            COMMIT_URL="${{ github.event.head_commit.url }}"
            AUTHOR="${{ github.event.head_commit.author.name }}"
            REPO="${{ github.repository }}"
            BRANCH="${{ github.ref_name }}"
            
            MESSAGE="ğŸš€ **ìƒˆë¡œìš´ ì»¤ë°‹ì´ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!**\n\nğŸ“ **ì €ì¥ì†Œ:** $REPO\nğŸŒ¿ **ë¸Œëœì¹˜:** $BRANCH\nğŸ™‹ **ì‘ì„±ì:** $AUTHOR\nğŸ“ **ì»¤ë°‹ ë©”ì‹œì§€:** $COMMIT_MESSAGE\nğŸ”— **ë§í¬:** $COMMIT_URL"
          fi

          # Discordë¡œ ë©”ì‹œì§€ ì „ì†¡
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\":\"$MESSAGE\"}" \
               "$DISCORD_WEBHOOK_URL"
